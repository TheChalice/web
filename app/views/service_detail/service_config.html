<div class="service-config">
    <h2>基础配置</h2>
    <hr>

    <h3>POD配置&nbsp;<span class="require"></span>
        <a href="javascript:;" class="href-add" ng-click="addContainer()">
            <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;<span style="font-size: 12px">添加容器</span>
        </a>
    </h3>

    <div ng-repeat="container in dc.spec.template.spec.containers" ng-class="{'bg-gray': container.show}">
        <div ng-if="!container.new">
            <div class="container-fluid container-bar">
                <div class="row">
                    <div class="col-sm-6">
                        {{container.name}}
                    </div>
                    <div class="col-sm-6 text-right">
                        <a class="icon25 icon25-collapse" ng-click="container.show = !container.show" uib-tooltip="查看" href="javascript:;"></a>
                        <a class="faa faa-times" ng-click="rmContainer($index)" uib-tooltip="删除" href="javascript:;"></a>
                    </div>
                </div>
            </div>

            <div uib-collapse="!container.show" class="container-box">
                <div style="margin-bottom: 20px;">
                    <a href="javascript:;" class="btn btn-orange" ng-click="selectImage($index)">选择镜像</a><span class="require"></span>
                </div>
                <div style="font-size: 12px;color: #5a6378;">
                    <div ng-if="container.image">
                        <p style="margin-bottom: 5px;">
                            镜像名称:&nbsp;&nbsp;{{container.image | imageStreamName}}
                        </p>
                        <p style="margin-bottom: 30px;">
                            镜像版本:&nbsp;&nbsp;{{container.tag}}
                        </p>
                    </div>
                    <hr>
                    <div>
                        <label ng-if="container.isshow" ng-class="{'active': container.isimageChange}" ng-click="container.isimageChange=!container.isimageChange" style="cursor: pointer;">
                            <i class="faa faa-check"></i>
                            &nbsp;&nbsp;镜像变化触发自动部署
                        </label>
                        <label ng-if="!container.isshow" style="cursor: pointer;color: #CCCCCC;">
                            <i class="faa faa-check"></i>
                            &nbsp;&nbsp;镜像变化触发自动部署
                        </label>
                    </div>
                    <hr>
                    <div>
                        <a href="javascript:;" style="font-size: 14px;" class="href-add" ng-click="addVolume($index)">
                            <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;添加卷
                        </a>
                        <div>

                        </div>
                    </div>

                    <div style="margin-top:20px;">
                        <table class="table table-bordered" border="0" cellpadding="0" cellspacing="0" style="border:0px;border-top:1px solid #ddd">
                            <tr ng-if="container.vol.secretarr.length">
                                <td class="col-md-2" style="padding:0; border: 1px solid #ddd;text-align: center;vertical-align: middle;background: #f7f8fb;"  >
                                    密钥
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div ng-repeat="secretarr in container.vol.secretarr">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{secretarr.secret.secretName}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{secretarr.mountPath}}</div>
                                    </div>

                                </td>
                            </tr>
                            <tr  ng-if="container.vol.configmap.length">
                                <td class="col-md-2" style="padding:0;  border: 1px solid #ddd;text-align: center;vertical-align: middle;background: #f7f8fb;">
                                    配置卷
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div ng-repeat="configmap in container.vol.configmap">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{configmap.configMap.name}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{configmap.mountPath}}</div>
                                    </div>
                                </td>
                            </tr>
                            <tr  ng-if="container.vol.persistentarr.length">
                                <td class="col-md-2" style="padding:0; border: 1px solid #ddd; text-align: center;vertical-align: middle;background: #f7f8fb;">
                                    持久化卷
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div  ng-repeat="persistentarr in container.vol.persistentarr">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{persistentarr.persistentVolumeClaim.claimName}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{persistentarr.mountPath}}</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <h4 ng-if="false">容器资源限额</h4>
                    <div ng-if="false">
                        CPU<=&nbsp;&nbsp;
                        <input type="text" class="form-control" style="width: 100px;display: inline-block;font-size: 12px;">
                        &nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;
                        内存<=&nbsp;&nbsp;
                        <input type="text" class="form-control" style="width: 100px;display: inline-block;font-size: 12px;">
                        &nbsp;&nbsp;GB
                    </div>
                </div>
            </div>
        </div>
        <div ng-if="container.new" style="border:1px solid #c9c9c9;border-radius:2px;margin-bottom: 15px;">
            <div class="container-fluid container-bar" style="border: none;background: #f7f8fb;">
                <div class="row">
                    <div class="col-sm-6">
                        设置容器
                    </div>
                    <div class="col-sm-6 text-right">
                        <a class="fa fa-times-circle fa-lg" ng-click="rmContainer($index)" style="text-decoration: none;color: #9fa7b7;" href="javascript:;"></a>
                    </div>
                </div>
            </div>

            <div class="container-box" style="margin-bottom: 0;background: #fff;">
                <div style="margin-bottom: 20px;">
                    <input ng-model="container.name" style="width: 95%;display: inline-block;" type="text" class="form-control" placeholder="请设置容器名称"><span class="require"></span>
                    <small ng-show="!container.name && container.emptyName" class="fa fa-info-circle err-tip">&nbsp;请设置容器名，至少2个字符以上</small>
                </div>
                <hr>
                <div style="margin-bottom: 20px;">
                    <a href="javascript:;" class="btn btn-orange" ng-click="selectImage($index)">选择镜像</a><span class="require"></span>
                    <br>
                    <small ng-if="!container.image && container.emptyImage" class="fa fa-info-circle err-tip">&nbsp;请选择镜像</small>
                </div>
                <div style="font-size: 12px;color: #5a6378;">
                    <div ng-if="container.image">
                        <p style="margin-bottom: 5px;">镜像名称:&nbsp;&nbsp;{{container.image | imageStreamName}}</p>
                        <p style="margin-bottom: 20px;">
                            镜像版本:&nbsp;&nbsp;{{container.tag}}
                        </p>
                    </div>
                    <hr>
                    <div>
                        <label ng-if="container.isshow" ng-class="{'active': container.isimageChange}" ng-click="container.isimageChange=!container.isimageChange" style="cursor: pointer;">
                            <i class="faa faa-check"></i>
                            &nbsp;&nbsp;镜像变化触发自动部署
                        </label>
                        <label ng-if="!container.isshow" style="cursor: pointer; color: #CCCCCC;">
                            <i class="faa faa-check"></i>
                            &nbsp;&nbsp;镜像变化触发自动部署
                        </label>
                    </div>
                    <hr>

                    <div>
                        <a href="javascript:;" style="font-size: 14px;" class="href-add" ng-click="addVolume($index)">
                            <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;添加卷
                        </a>
                        <div>

                        </div>
                    </div>
                    <div style="margin-top:20px;">
                        <table class="table table-bordered" border="0" cellpadding="0" cellspacing="0" style="border:0px;border-top:1px solid #ddd">
                            <tr ng-if="container.vol.secretarr.length">
                                <td class="col-md-2" style="padding:0; border: 1px solid #ddd;text-align: center;vertical-align: middle;background: #f7f8fb;"  >
                                    密钥
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div ng-repeat="secretarr in container.vol.secretarr">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{secretarr.secret.secretName}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{secretarr.mountPath}}</div>
                                    </div>

                                </td>
                            </tr>
                            <tr  ng-if="container.vol.configmap.length">
                                <td class="col-md-2" style="padding:0;  border: 1px solid #ddd;text-align: center;vertical-align: middle;background: #f7f8fb;">
                                    配置卷
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div ng-repeat="configmap in container.vol.configmap">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{configmap.configMap.name}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{configmap.mountPath}}</div>
                                    </div>
                                </td>
                            </tr>
                            <tr  ng-if="container.vol.persistentarr.length">
                                <td class="col-md-2" style="padding:0; border: 1px solid #ddd; text-align: center;vertical-align: middle;background: #f7f8fb;">
                                    持久化卷
                                </td>
                                <td class="col-md-10" style="padding:0;border: 0px;" border="0">
                                    <div  ng-repeat="persistentarr in container.vol.persistentarr">
                                        <div style="border-bottom: 1px solid #ddd;height: 30px;border-right:1px solid #ddd ;line-height: 30px;padding-left:15px;">{{persistentarr.persistentVolumeClaim.claimName}}</div>
                                        <div style="height: 30px;line-height: 30px;border-bottom: 1px solid #ddd;border-right:1px solid #ddd ;padding-left:15px;">{{persistentarr.mountPath}}</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h3>端口开放&nbsp; <a ng-click="addprot()" class="href-add" style="line-height: 40px; margin-bottom: 10px" href="javascript:;">
        <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;<span style="font-size: 12px">添加端口</span>
    </a></h3>

    <div class="table-responsive" style="margin-bottom: 30px;overflow: hidden;">
        <table class="table table-hover table-default sub-table" style="padding-bottom: 20px;">
            <tr>
                <!--<th style="width: 20%;">容器名称</th>-->
                <!--<th style="width: 30%; display: none;">镜像</th>-->
                <th style="width: 50%;">端口</th>
            </tr>
            <tr>
                <td>
                    <div class="row">
                        <div class="col-sm-3">协议</div>
                        <div class="col-sm-3">容器端口</div>
                        <div class="col-sm-3">服务端口</div>
                        <div class="col-sm-3"></div>
                    </div>
                </td>

            </tr>
            <tr ng-repeat="port in portsArr">
                <!--<td style="vertical-align: middle;">-->
                    <!--{{container.name}}-->
                <!--</td>-->
                <!--<td style="vertical-align: middle; display: none;">-->
                    <!--<span>-->
                        <!--<p>镜像名称:</p>-->
                        <!--<p>{{container.image | imageStreamName}}</p>-->
                        <!--<p>镜像版本:</p>-->
                        <!--<p><span>{{container.tag}}</span></p>-->
                    <!--</span>-->
                <!--</td>-->
                <td style="vertical-align: middle;border-top: none;padding:0px;">

                    <div class="row" style="margin-top: 15px;margin-left:0px;margin-right: 0px;">
                        <div class="col-sm-3">
                            <!--<input type="text"-->
                            <!--class="input-small"-->
                            <!--ng-model="port.protocol">-->
                            <select class="input-small" ng-model="port.protocol">
                                <option value="TCP">TCP</option>
                                <option value="UDP">UDP</option>
                            </select>
                        </div>
                        <div class="col-sm-3">
                            <input type="text" class="input-small"
                                   ng-class="{'input-error':port.conflict}"
                                   ng-model="port.containerPort">
                        </div>
                        <div class="col-sm-3">
                            <input type="text"  ng-class="{'input-error':port.serviceConflict}" ng-model="port.hostPort" class="input-small">
                        </div>
                        <div class="col-sm-3">
                            <a href="javascript:;" style='color: #9fa7b7;' ng-click="delprot($index)"
                               class="fa fa-lg fa-times-circle"
                               ></a>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <h2>高级配置</h2>
    <hr>

    <div class="row">
        <div class="col-md-2" style="padding-top: 10px;">
            <h3>服务高可用</h3>
        </div>
        <div class="col-md-10">
            <label style="font-size: 12px; font-weight: normal;">POD数量&nbsp;&nbsp;&nbsp;&nbsp;</label>
            <input ng-model="dc.spec.replicas" name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control">
            <hr>
            <div ng-if="false">
                <label style="font-size: 12px; font-weight: normal;">自动伸缩&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <c-checkbox checked="rubustCheck"></c-checkbox>
                <br>
                <div ng-if="rubustCheck">
                    <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">资源阈值&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <span style="font-size: 12px">POD最小数量  <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                    <span style="font-size: 12px">POD最大数量  <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                    <span style="font-size: 12px">CPU平均利用率 <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                </div>
                <hr>
            </div>
            <label style="font-size: 12px; font-weight: normal;">重启策略&nbsp;&nbsp;&nbsp;&nbsp;</label>
            <div class="dropdown dropdown-select" style="width: 200px;">
                <button class="btn dropdown-toggle" data-toggle="dropdown">
                    <span>{{dc.spec.template.spec.restartPolicy}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'Always'">Always</a>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'OnFailure'">OnFailure</a>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'Never'">Never</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <hr style="margin-top: 20px;">

    <div class="row">
        <div class="col-md-2" style="padding-top: 5px">
            <h3>路由设置</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="grid.route"></c-checkbox>
            <br>
            <div ng-if="grid.route">
                <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">服务端口&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="dropdown dropdown-select" ng-click="getupdatePorts()" style="width: 80px;">
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span>{{grid.port || '请选择'}}</span>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li ng-repeat="port in grid.ports">
                            <a href="javascript:;" ng-click="grid.port = port">{{port}}</a>
                        </li>
                    </ul>
                </div>

                <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">域名&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <input style="width: 160px;display: inline-block;" ng-model="grid.host" type="text" class="form-control">
                <span style="font-size: 12px;">{{grid.suffix}}</span>
            </div>
        </div>
    </div>
    <hr style="margin-top: 20px;">

    <div class="row">
        <div class="col-md-2">
            <h3>后端服务绑定</h3>
        </div>
        <div class="col-md-10">
            <a ui-sref="console.backing_service" class="href-add">
                <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;<span style="font-size: 12px">创建</span>
            </a>
        </div>
        <div class="col-md-9 col-md-offset-2">
            <div class="panel panel-default sub-panel">
                <div class="panel-heading">
                    后端服务实例
                </div>
                <div class="panel-body" style="padding-bottom: 0;">
                    <div class="row">
                        <div class="col-md-6" ng-repeat="item in bsi.items">
                            <div class="tabandimage" ng-class="{'selected': item.bind}" ng-click="item.bind = !item.bind">
                                <i class="faa faa-image" style="float: left;margin-right: 10px;"></i>
                                <i class="faa faa-image-mark" ng-show="item.bind"></i>
                                <p style="margin: 10px 0 5px 0;">{{item.metadata.name}}</p>
                                <p>{{item.spec.provisioning.backingservice_name}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr>

    <div class="row">
        <div class="col-md-2">
            <h3>环境变量设置</h3>
        </div>
        <div class="col-md-10">
            <a href="javascript:;" class="href-add" ng-click="addEnv()">
                <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;<span style="font-size: 12px">创建环境变量</span>
            </a>
        </div>
        <div class="col-md-9 col-md-offset-2">
            <div class="panel panel-default sub-panel">
                <div class="panel-heading">
                    环境变量设置
                </div>
                <div class="panel-body" style="padding-bottom: 0;">
                    <span ng-if="envs.length > 0">
                        <div class="row key-value-bar" style="margin-bottom: 15px" ng-repeat="env in envs">
                            <div class="col-md-5">
                                <div style="float: left;line-height: 36px;">键&nbsp;&nbsp;</div>
                                <div style="overflow: hidden">
                                    <input ng-model="env.name" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div style="float: left;line-height: 36px;">值&nbsp;&nbsp;</div>
                                <div style="overflow: hidden">
                                    <input ng-model="env.value" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-1" id='xz' style="line-height: 36px;">
                                <a href="javascript:;"

                                   ng-click="delEnv($index)"
                                   class="fa fa-lg fa-times-circle">

                                </a>
                            </div>
                        </div>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <hr>

    <div class="row">
        <div class="col-md-2">
            <h3>自动部署</h3>
        </div>
        <div class="col-md-5">
            <!--<label ng-if="grid.isimageChange" ng-class="{'active': grid.imageChange}" ng-click="grid.imageChange=!grid.imageChange" style="cursor: pointer;">-->
                <!--<i class="faa faa-check"></i>-->
                <!--&nbsp;&nbsp;镜像变化触发自动部署-->
            <!--</label>-->
            <!--<label ng-if="!grid.isimageChange" style="cursor: pointer; color: #CCCCCC">-->
                <!--<i class="faa faa-check"></i>-->
                <!--&nbsp;&nbsp;镜像变化触发自动部署-->
            <!--</label>-->
        </div>
        <div class="col-md-5">
            <!--<labe><input type="checkbox" ng-model="grid.configChange">&nbsp;&nbsp;配置变化触发自动部署</labe>-->
            <label ng-class="{'active': grid.configChange}" ng-click="grid.configChange=!grid.configChange" style="cursor: pointer;">
                <i class="faa faa-check"></i>
                &nbsp;&nbsp;配置变化触发自动部署
            </label>
        </div>
    </div>
    <hr>

    <div class="row" ng-if="false">
        <div class="col-md-2" style="padding-top: 5px;">
            <h3>性能监控</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="checkedthird"></c-checkbox>&nbsp;&nbsp;&nbsp;&nbsp;
            <a ng-if="checkedthird" class="btn btn-orange">性能监测配置</a>
        </div>
    </div>
    <hr style="margin-top: 20px;" ng-if="false">

    <div class="row" ng-if="false">
        <div class="col-md-2" style="padding-top: 5px;">
            <h3>警告服务</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="checkedforth"></c-checkbox>&nbsp;&nbsp;&nbsp;&nbsp;
            <a ng-if="checkedforth" class="btn btn-orange">告警服务配置</a>
        </div>
    </div>
    <hr style="margin-top: 20px;" ng-if="false">
    <small ng-show="servicepoterr" class="fa fa-info-circle err-tip">&nbsp;端口填写错误</small>
    <small ng-show="grid.conflict" class="fa fa-info-circle err-tip">&nbsp;容器端口冲突，请修改</small>
    <small ng-show="grid.serviceConflict" class="fa fa-info-circle err-tip">&nbsp;服务端口冲突，请修改</small>
    <button class="btn btn-orange btn-block" ng-click="updateDc()">更新(会自动触发重新部署)</button>

</div>
