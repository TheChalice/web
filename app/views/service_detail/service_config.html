<div class="service-config">
    <h2>基础配置</h2>
    <hr>

    <h3>POD配置&nbsp;<span class="require"></span>
        <a href="javascript:;" class="href-add" ng-click="addContainer()">
            <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;添加容器
        </a>
    </h3>

    <div ng-repeat="container in dc.spec.template.spec.containers" ng-class="{'bg-gray': true}">
        <div class="container-fluid container-bar">
            <div class="row">
                <div class="col-sm-6">
                     {{container.name}}
                </div>
                <div class="col-sm-6 text-right">
                    <a class="icon25 icon25-collapse" ng-click="container.show = !container.show" uib-tooltip="查看" href="javascript:;"></a>
                    <a class="faa faa-times" ng-click="rmContainer($index)" uib-tooltip="删除" href="javascript:;"></a>
                </div>
            </div>
        </div>

        <div uib-collapse="!container.show" class="container-box">
            <div style="margin-bottom: 20px;" ng-if="container.new">
                <h4>设置容器名称</h4>
                <input ng-model="container.name" style="width: 300px;display: inline-block;" type="text" class="form-control" placeholder="请设置容器名称"><span class="require"></span>
            </div>
            <div style="margin-bottom: 20px;">
                <a href="javascript:;" class="btn btn-orange" ng-click="selectImage($index)">选择镜像</a><span class="require"></span>
            </div>
            <div style="font-size: 12px;color: #5a6378;">
                <div ng-if="container.image">
                    <p style="margin-bottom: 5px;">镜像名称:&nbsp;&nbsp;{{container.image}}</p>
                    <p style="margin-bottom: 30px;">
                        镜像版本:&nbsp;&nbsp;<span ng-if="container.ref">{{container.ref}} - </span>{{container.commitId | limitTo: 7}}
                    </p>
                </div>

                <h4>挂载secret卷&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="fa fa-plus-circle fa-lg href-add">&nbsp;&nbsp;创建</a></h4>

                <div class="secret-bar" ng-repeat="vm in container.volumeMounts">
                    <div class="dropdown dropdown-select" style="width: 200px;margin: 0 15px 15px 0;">
                        <button class="btn dropdown-toggle" data-toggle="dropdown">
                            <span>{{vm.name || '请选择'}}</span>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-repeat="s in secrets.items">
                                <a href="javascript:;" ng-click="vm.name = s.metadata.name">{{s.metadata.name}}</a>
                            </li>
                        </ul>
                    </div>
                    <input ng-model="vm.mountPath" style="width: 300px;display: inline-block;margin: 0 15px 15px 0;" type="text" class="form-control">
                    <a href="javascript:;" ng-click="addSecret(container.name, $index, $last)" class="fa fa-lg" ng-class="{'fa-times-circle':!$last, 'fa-plus-circle':$last}"></a>
                </div>

                <h4 ng-if="false">容器资源限额</h4>
                <div ng-if="false">
                    CPU<=&nbsp;&nbsp;
                    <input type="text" class="form-control" style="width: 100px;display: inline-block;font-size: 12px;">
                    &nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;
                    内存<=&nbsp;&nbsp;
                    <input type="text" class="form-control" style="width: 100px;display: inline-block;font-size: 12px;">
                    &nbsp;&nbsp;GB
                </div>
            </div>
        </div>
    </div>

    <h3>端口开放&nbsp;<span class="require"></span></h3>

    <div class="table-responsive" style="margin-bottom: 30px;">
        <table class="table table-hover table-default sub-table">
            <tr>
                <th style="width: 20%;">容器名称</th>
                <th style="width: 30%">镜像</th>
                <th style="width: 50%;">端口</th>
            </tr>
            <tr ng-repeat="container in dc.spec.template.spec.containers">
                <td style="vertical-align: middle;">
                    {{container.name}}
                </td>
                <td style="vertical-align: middle;">
                    <span>
                        <p>{{container.image | imageStreamName}}</p>
                        <p><span ng-if="container.ref">{{container.ref}} - </span>{{container.commitId | limitTo: 7}}</p>
                    </span>
                </td>
                <td style="vertical-align: middle;">
                    <div class="row">
                        <div class="col-sm-3">协议</div>
                        <div class="col-sm-3">容器端口</div>
                        <div class="col-sm-3">服务端口</div>
                        <div class="col-sm-3"></div>
                    </div>
                    <div class="row" ng-repeat="port in container.ports" style="margin-top: 15px;">
                        <div class="col-sm-3"><input type="text" readonly class="input-small" ng-model="port.protocol"></div>
                        <div class="col-sm-3">
                            <input type="text" readonly class="input-small" ng-class="{'input-error':port.conflict}" ng-model="port.containerPort">
                        </div>
                        <div class="col-sm-3"><input type="text" ng-model="port.servicePort" class="input-small"></div>
                        <div class="col-sm-3"><input type="checkbox" ng-model="port.open">&nbsp;开放</div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <h2>高级配置</h2>
    <hr>

    <div class="row">
        <div class="col-md-2" style="padding-top: 10px;">
            <h3>服务高可用</h3>
        </div>
        <div class="col-md-10">
            <label style="font-size: 12px; font-weight: normal;">POD数量&nbsp;&nbsp;&nbsp;&nbsp;</label>
            <input ng-model="dc.spec.replicas" name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control">
            <hr>
            <div ng-if="false">
                <label style="font-size: 12px; font-weight: normal;">自动伸缩&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <c-checkbox checked="rubustCheck"></c-checkbox>
                <br>
                <div ng-if="rubustCheck">
                    <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">资源阈值&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <span style="font-size: 12px">POD最小数量  <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                    <span style="font-size: 12px">POD最大数量  <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                    <span style="font-size: 12px">CPU平均利用率 <input name="cdm" min="1" max="10"  style="width: 80px;display: inline-block;" type="number" class="form-control"></span>
                </div>
                <hr>
            </div>
            <label style="font-size: 12px; font-weight: normal;">重启策略&nbsp;&nbsp;&nbsp;&nbsp;</label>
            <div class="dropdown dropdown-select" style="width: 200px;">
                <button class="btn dropdown-toggle" data-toggle="dropdown">
                    <span>{{dc.spec.template.spec.restartPolicy}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'Always'">Always</a>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'OnFailure'">OnFailure</a>
                        <a href="javascript:;" ng-click="dc.spec.template.spec.restartPolicy = 'Never'">Never</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <hr style="margin-top: 20px;">

    <div class="row">
        <div class="col-md-2" style="padding-top: 5px">
            <h3>路由设置</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="grid.route"></c-checkbox>
            <br>
            <div ng-if="grid.route">
                <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">服务端口&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="dropdown dropdown-select" style="width: 80px;">
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span>{{grid.port || '请选择'}}</span>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li ng-repeat="port in grid.ports">
                            <a href="javascript:;" ng-click="grid.port = port">{{port}}</a>
                        </li>
                    </ul>
                </div>

                <label style="font-size: 12px; font-weight: normal;  margin-top: 35px;">域名&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <input style="width: 160px;display: inline-block;" ng-model="grid.host" type="text" class="form-control">
                <span style="font-size: 12px;">{{grid.suffix}}</span>
            </div>
        </div>
    </div>
    <hr style="margin-top: 20px;">

    <div class="row">
        <div class="col-md-2">
            <h3>后端服务绑定</h3>
        </div>
        <div class="col-md-10">
            <a href="javascript:;" class="href-add">
                <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;创建
            </a>
        </div>
        <div class="col-md-9 col-md-offset-2">
            <div class="panel panel-default sub-panel">
                <div class="panel-heading">
                    后端服务设置
                </div>
                <div class="panel-body" style="padding-bottom: 0;">
                    <div class="row">
                        <div class="col-md-6" ng-repeat="item in bsi.items">
                            <div class="tabandimage" ng-class="{'selected': item.bind}" ng-click="item.bind = !item.bind">
                                <i class="faa faa-image" style="float: left;margin-right: 10px;"></i>
                                <i class="faa faa-image-mark" ng-show="item.bind"></i>
                                <p style="margin: 10px 0 5px 0;">{{item.metadata.name}}</p>
                                <p>{{item.spec.provisioning.backingservice_name}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr>

    <div class="row">
        <div class="col-md-2">
            <h3>环境变量设置</h3>
        </div>
        <div class="col-md-10">
            <a href="javascript:;" class="href-add" ng-click="addEnv('', 0, true)">
                <i class="fa fa-plus-circle fa-lg"></i>&nbsp;&nbsp;创建环境变量
            </a>
        </div>
        <div class="col-md-9 col-md-offset-2">
            <div class="panel panel-default sub-panel">
                <div class="panel-heading">
                    环境变量设置
                </div>
                <div class="panel-body" style="padding-bottom: 0;">
                    <span ng-if="envs.length > 0">
                        <div class="row key-value-bar" style="margin-bottom: 15px" ng-repeat="env in envs">
                            <div class="col-md-5">
                                <div style="float: left;line-height: 36px;">键&nbsp;&nbsp;</div>
                                <div style="overflow: hidden">
                                    <input ng-model="env.name" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div style="float: left;line-height: 36px;">值&nbsp;&nbsp;</div>
                                <div style="overflow: hidden">
                                    <input ng-model="env.value" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-1" style="line-height: 36px;">
                                <a href="javascript:;" ng-click="addEnv(env.name, $index, $last)" class="fa fa-lg" ng-class="{'fa-times-circle':!$last, 'fa-plus-circle':$last}"></a>
                            </div>
                        </div>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <hr>

    <div class="row">
        <div class="col-md-2">
            <h3>自动部署</h3>
        </div>
        <div class="col-md-5">
            <labe><input type="checkbox" ng-model="grid.imageChange">&nbsp;&nbsp;镜像变化触发自动部署</labe>
        </div>
        <div class="col-md-5">
            <labe><input type="checkbox" ng-model="grid.configChange">&nbsp;&nbsp;配置变化触发自动部署</labe>
        </div>
    </div>
    <hr>

    <div class="row" ng-if="false">
        <div class="col-md-2" style="padding-top: 5px;">
            <h3>性能监控</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="checkedthird"></c-checkbox>&nbsp;&nbsp;&nbsp;&nbsp;
            <a ng-if="checkedthird" class="btn btn-orange">性能监测配置</a>
        </div>
    </div>
    <hr style="margin-top: 20px;" ng-if="false">

    <div class="row" ng-if="false">
        <div class="col-md-2" style="padding-top: 5px;">
            <h3>警告服务</h3>
        </div>
        <div class="col-md-10">
            <c-checkbox checked="checkedforth"></c-checkbox>&nbsp;&nbsp;&nbsp;&nbsp;
            <a ng-if="checkedforth" class="btn btn-orange">告警服务配置</a>
        </div>
    </div>
    <hr style="margin-top: 20px;" ng-if="false">

    <button class="btn btn-orange btn-block" ng-click="updateDc()">更新(会自动触发重新部署)</button>

</div>
