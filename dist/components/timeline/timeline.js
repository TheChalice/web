angular.module("console.timeline",[{files:["components/timeline/timeline.css"]}]).directive("cTimeline",[function(){return{restrict:"EA",replace:!0,controller:["$scope","$log","Build","Confirm","$stateParams",function(e,t,n,r,i){e.buildLog={},e.collapseLog={},i.from=="create"&&e.$watch("data",function(t,n){t!=n&&t.items.length>0&&e.getLog(0)}),e.getLog=function(r){var i=e.data.items[r];i.showLog=!i.showLog;if(i.status.phase=="Pending")return;if(i.buildLog)return;n.log.get({name:i.metadata.name},function(e){var t="";for(var n in e)t+=e[n];i.buildLog=t},function(e){t.info("err",e)})},e.delete=function(i){var s=e.data.items[i].metadata.name;r.open("删除构建","您确定要删除项目吗?","删除项目将清除项目的所有历史数据以及相关的镜像该操作不能被恢复","recycle").then(function(){n.remove({name:s},function(){t.info("deleted");for(var n=0;n<e.data.items.length;n++)s==e.data.items[n].metadata.name&&e.data.items.splice(n,1)},function(e){t.info("err",e)})})},e.stop=function(i){var s=e.data.items[i];s.status.cancelled=!0,r.open("提示信息","您确定要终止本次构建吗?").then(function(){n.put({name:s.metadata.name},s,function(n){t.info("stop build success"),e.data.items[i]=n},function(e){e.data.code==409&&r.open("提示信息","当数据正在New的时候,构建不能停止,请等到正在构建时,在请求停止.")})})}}],scope:{data:"="},templateUrl:"components/timeline/timeline.html"}}]);